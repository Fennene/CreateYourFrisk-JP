<!DOCTYPE html>
<!--
since you're here anyway: there's a small easter egg on the text commands page but it's probably not worth finding, sorry
you may notice this page's code is garbage: i'm not a web designer! ;-;
it's w3c valid, at least
-->

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>CYF ドキュメント - 発射体(Projectile) 制御</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/themesidebar.css" rel="stylesheet">
    <link href="../css/shThemeRDark.css" rel="stylesheet">

    <!-- Syntax highlighting -->
    <script type="text/javascript" src="../js/shCore.js"></script>
    <script type="text/javascript" src="../js/shBrushLua.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<img src="../img/bg2.png" alt="Undertale background" class="backimg">
<div class="container arena black">
    <div class="col-md-2">
        <!--navigation-->
        <nav class="nav-sidebar">
            <ul class="nav tabs">
                <li class="li-header">基本</li>
                    <li><a href="../documentation.html">ようこそ</a></li>
                    <li><a href="howtoread.html">このドキュメントの読み方</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li><a href="controls.html">操作方法</a></li>
                    <li><a href="basic.html">基本構成</a></li>
                    <li><a href="unity.html"><span class="CYF"></span> Unity Setup (Optional)</a></li>
                    <li><a href="variables.html">予約変数</a></li>
                    <li><a href="terms.html">用語</a></li>
                <li class="li-header">API</li>
                    <li><a href="api-text.html">テキストコマンド</a></li>
                    <li class="new"><a href="api-events.html">ゲームイベント</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent">関数 &amp; オブジェクト:</li>
                        <li class="li-indent new"><a href="api-functions-main.html">その他関数</a></li>
                        <li class="li-indent new"><a href="api-functions-player.html">Player オブジェクト</a></li>
                        <li class="li-indent"><a href="api-functions-script.html">Script オブジェクト</a></li>
                        <li class="li-indent"><a href="api-functions-audio.html">Audio オブジェクト</a></li>
                        <li class="li-indent"><a href="api-functions-newaudio.html"><span class="CYF"></span> NewAudio オブジェクト</a></li>
                        <li class="li-indent"><a href="api-functions-input.html">Input オブジェクト</a></li>
                        <li class="li-indent"><a href="api-functions-time.html">Time オブジェクト</a></li>
                        <li class="li-indent"><a href="cyf-inventory.html"><span class="CYF"></span> Inventory オブジェクト</a></li>
                        <li class="li-indent new"><a href="api-functions-misc.html"><span class="CYF"></span>Misc オブジェクト</a></li>
                        <li class="li-indent new"><a href="api-functions-discord.html"><span class="CYF"></span> The Discord Object</a></li>
                        <li class="li-indent"><a href="api-functions-waves.html">Arena オブジェクト</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="active" style="margin-left:5px;">&gt; 発射体(Projectile) 管理 &lt;</li>
                    <li><a href="cyf-ppcollision.html"><span class="CYF"></span> The Pixel-Perfect Collision システム</a></li>
                    <li class="new"><a href="api-animation.html">スプライト &amp; アニメーション</a></li>
                    <li class="new"><a href="cyf-text.html"><span class="CYF"></span> Text オブジェクト</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                <li class="li-header"></span><span class="CYF"></span> <span class="new"></span>Shaders</li>
                    <li><a href="shaders.html">Introduction</a></li>
                    <li><a href="shaders-object.html">The Shader Object</a></li>
                    <li><a href="shaders-coding.html">Coding a Shader</a></li>
                    <hr style="margin-top:10px;margin-bottom:10px;">
                <li class="li-header"><span class="CYF"></span> Overworld</li>
                    <li class="new"><a href="overworld.html">Basics</a></li>
                    <li><a href="overworld-howto-map.html">How to create a map</a></li>
                    <li><a href="overworld-howto-event.html">How to create an event</a></li>
                    <li><a href="overworld-howto-animevent.html">How to animate an event</a></li>
                    <li class="new"><a href="overworld-howto-shop.html">How to create a shop</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent"><span class="CYF"></span> Overworld Objects:</li>
                        <li class="li-indent"><a href="overworld-object-general.html">The General Object</a></li>
                        <li class="li-indent"><a href="overworld-object-event.html">The Event Object</a></li>
                        <li class="li-indent"><a href="overworld-object-player.html">The Player Object</a></li>
                        <li class="li-indent"><a href="overworld-object-screen.html">The Screen Object</a></li>
                        <li class="li-indent"><a href="overworld-object-inventory.html">The Inventory Object</a></li>
                        <li class="li-indent new"><a href="overworld-object-map.html">The Map Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                <li class="li-header">素材</li>
                    <li><a href="../media/dialogoptions.png">吹き出し一覧</a></li>
                    <li><a href="api-keys.html"><span class="CYF"></span> キーリスト</a></li>
            </ul>
        </nav>
    </div>
    <!--tabs'n'shit-->
    <div class="tab-content col-md-10">
        <div class="tab-pane active text-style" id="api-projectile">
            <h2>発射体(Projectile) 管理</h2><br><br>
            <p>発射体(Projectile)の制御はv0.2.0からEncounterスクリプトとWaveスクリプトの両方で使えるようになったため、独自のセクションに分けました。</p>
            <p>
                <br><span class="function"><span class="CYF"></span>CreateProjectileLayer(<span class="string"></span> name,
                <span class="string"></span> position = "", <span class="boolean"></span> below = false) [E/W]</span>
                Creates a layer named <span class="term">name</span> that projectiles can be placed in. To create your new projectile layer, you'll need to choose a pre-existing layer.
                <br><br>
                <span class="term">position</span> must be the name of an existing projectile layer.<br>
                The only default layer is <span class="term">""</span>, so <b>you must use it first</b>.
                <br><br>
                If <span class="term">before</span> is true, the new layer will be created below the layer given in <span class="term">position</span>,
                otherwise it will be above it.
            </p>

            <p>
                <br><span class="function">CreateProjectile(<span class="string"></span> spritename, <span class="number"></span> initial_x,
                <span class="number"></span> initial_y,<span class="CYF"></span> <span class="string"></span> layer = "") returns <span class="userdata">bullet</span> [E/W]</span>
                アリーナ中心を基準とした座標に、発射体(Projectile)を生成します。
                CYFのPPモードを使用しない限り、発射体のヒットボックス(当たり判定)は長方形です。<br>
                <span class="CYF"></span> You can specify a layer if you want - otherwise, the bullet will be in the normal bullet layer.
            </p>

            <p>
                <br><span class="function">CreateProjectileAbs(<span class="string"></span> spritename, <span class="number"></span> initial_x,
                <span class="number"></span> initial_y,<span class="CYF"></span> <span class="string"></span> layer = "") returns <span class="userdata">bullet</span> [E/W]</span>
                <span class="term">CreateProjectile</span>と同じですが、生成する座標の基準が画面左下端になります。
                CYFのPPモードを使用しない限り、発射体のヒットボックス(当たり判定)は長方形です。<br>
                <span class="CYF"></span> You can specify a layer if you want - otherwise, the bullet will be in the normal bullet layer.
            </p>

            <p>
                <hr>
                <h4>弾丸(Bullet) オブジェクト</h4>
                This is what you use to move around the arena and store values in. You can store a bunch of bullets in a table
                and modify them. The functions and variables you can use on a Bullet are as follows.</p>
            </p>
            <p>
                <br><span class="function"><span class="userdata">sprite</span> Bullet.sprite</span>
                弾丸のスプライトコンポーネント。 使用方法に関しては、<span class="ref">スプライト &amp; アニメーション</span>を参照してください。
                <br><br>
                注: Unitale v0.2.1a では、スプライトを変更しても、ヒットボックス(当たり判定)は変更されません。
                常に最初のスプライトの大きさの正方形になります。
                <br><br>
                <span class="CYF"></span> しかし、CYFでは弾丸のスプライトが変更されると、ヒットボックスも自動的に<i>変更されます</i>！
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.x</span>
                アリーナ中心を基準とした時のX座標。
                <span class="term">x=0</span>かつ<span class="term">y=0</span>で、アリーナの中心に配置されます。
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.y</span>
                アリーナ中心を基準とした時のY座標。
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.absx</span>
                画面左下端を基準とした時のX座標。
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.absy</span>
                画面左下端を基準とした時のY座標。
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="boolean"></span> Bullet.ppcollision</span>
                trueを指定すると、弾丸はThe Pixel-Perfect Collision システムを使用します。
                <br><br>
                デフォルトでは、エンカウンターで設定された<b style="color:#fff">通常の</b>当たり判定のシステムを使用します。
                <br><br>
                <font color="#fff">* これを手動で設定すると、<span class="term">Bullet.ppchanged</span>がtrueになります。</font>
                <br><br>
                詳細は、<span class="ref">The Pixel-Perfect Collision System</span>の<span class="term">SetPPCollision</span>を参照してください。
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="boolean"></span> Bullet.ppchanged (読み取り専用)</span>
                <span class="term">Bullet.ppcollision</span>を、手動で変更したかどうかを返します。
                <br><br>
                <font color="#fff">* <span class="term">Bullet.ppchanged</span>がtrueになっている弾丸は、<br>
                <span class="term">SetPPCollision</span>の変更の影響を受けません。(<span class="ref">The Pixel-Perfect Collision System</span>を参照してください。)</font>
                <br><br>
                <span class="term">Bullet.ResetCollisionSystem()</span>を呼び出すか、
                <span class="term">Bullet.ppcollision</span>を変更していない場合はfalseを返します。
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> Bullet.ResetCollisionSystem()</span>
                Resets the collision system of the bullet to the encounter's <b style="color:#fff">default</b> collision system.
                <br><br>
                The default collision system is set by <span class="term">SetPPCollision</span>.<br>
                See <span class="ref">The Pixel-Perfect Collision System</span> for more information.
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="string"></span> Bullet.layer</span>
                The bullet layer that the bullet is on.
                <br><br>
                Set it back to <span class="term">""</span> to return the bullet to the default layer.
            </p>
            <p>
                <br><span class="function"><span class="boolean"></span> Bullet.isactive (読み取り専用)</span>
                弾丸がアクティブ(<span class="term">bullet.Remove()</span>されていない)かどうか返します。
                <br><br>
                弾丸が削除されている場合は<span class="term">false</span>を、そうでなければ<span class="term">true</span>を返します。
            </p>
            <p>
                <br><span class="function">Bullet.Move(<span class="number"></span> x, <span class="number"></span> y)</span>
                弾丸を(現在位置を基準として)、右方向に<span class="term">x</span>ピクセル、上方向に<span class="term">y</span>ピクセル動かします。
                <br><br>
                <span class="term">x</span>を負の数にすると左方向に、
                <span class="term">y</span>を負の数にすると下方向に動かせます。
            </p>
            <p>
                <br><span class="function">Bullet.MoveTo(<span class="number"></span> x, <span class="number"></span> y)</span>
                アリーナの中心を基準として、指定した位置に移動させます。
            </p>
            <p>
                <br><span class="function">Bullet.MoveToAbs(<span class="number"></span> x, <span class="number"></span> y)</span>
                画面左下端を基準として、指定した位置に移動させます。
            </p>
            <p>
                <br><span class="function">Bullet.Remove()</span>
                弾丸を<strike>デストロイ</strike>...<strike>破壊</strike>...いや、削除します。
                <br><br>
                弾丸の<span class="term">x</span>や
                <span class="term">y</span>、<span class="term">absx</span>、<span class="term">absy</span>の取得はできます。
                しかし、削除された弾丸を動かそうとすると、Luaのエラーが発生します。If you're not sure if your
                弾丸が削除されていないか分からない場合は、<span class="term">Bullet.isactive</span>を使用して確認してください。
            </p>
            <p>
                <br><span class="function">Bullet[<span class="string"></span> your_variable_name] = value <font style="color:#fff">(OR)</font></span>
                <span class="function">Bullet.SetVar(<span class="string"></span> your_variable_name, value)</span>
                <span class="term">Bullet.GetVar</span>で取得できる変数を、弾丸に設定します。
                <br><br>
                <span class="term">SetGlobal</span>と似ていますが、これは弾丸ごとに設定が可能であり、特定の値を保持させることができます。
            </p>
            <p>
                <br><span class="function">Bullet[<span class="string"></span> your_variable_name] <font style="color:#fff">(OR)</font></span>
                <span class="function">Bullet.GetVar(<span class="string"></span> your_variable_name)</span>
                <span class="term">Bullet.SetVar</span>で設定した変数を取得できます。
            </p>
            <p>
                <br><span class="function">Bullet.SendToTop()</span>
                Moves this bullet on top of all currently existing projectiles.
                <br><br>
                Note that newly spawned projectiles are always on top by default;
                this function is mostly to move existing bullets to the top.
                <br><br>
                <span class="CYF"></span> 弾丸を現在のレイヤーの１番上に移動させます。
            </p>
            <p>
                <br><span class="function">Bullet.SendToBottom()</span>
                Moves this bullet below all currently existing projectiles.
                <br><br>
                <span class="CYF"></span> 弾丸を現在のレイヤーの１番下に移動させます。
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> Bullet.isColliding()</span>
                プレイヤーと弾丸が衝突している場合にtrueを返します。
                <strike>ダメージ、回復とか、ただの弾丸の当たり判定チェックならOnHit()を使おう。by翻訳者</strike>
                <br><br>
                Will use PPCollision (pixel-perfect collisions) if the bullet has PP enabled. See <span class="term">Bullet.ppcollision</span>.</li><br>
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="boolean"></span> Bullet.isPersistent = false</span>
                Set this to true and, if you're not in retrocompatibility mode, this will make the bullet stay loaded even after the wave ends.
            </p>
            <br><hr><br>
            <p>これは、かなり早く追いかけるが、プレイヤーと近づくにつれて遅くなる弾丸の例です。これを避けるには、
                常に動いてかわす必要があります。Playerオブジェクトを使用する基本的な例でもあります。</p>
            <div class="code-container">
<pre class="brush: lua;">oursprite = "hOI!!!!"
--Create a new bullet, starting in the upper right corner.
chasingbullet = CreateProjectile(oursprite, Arena.width/2, Arena.height/2)
--Set initial speed of 0 in both directions.
chasingbullet.SetVar('xspeed', 0)
chasingbullet.SetVar('yspeed', 0)

function Update()
    -- Get the x/y difference between the player and bullet
    local xdifference = Player.x - chasingbullet.x
    local ydifference = Player.y - chasingbullet.y
    -- We create a new speed by first halving the original speed
    -- Then we add a small fraction of the position difference between the player and bullet.
    -- The result is a bullet that moves faster as it's further away, and slower when it's closer.
    -- The value we're dividing by is experimental. Experimenting with numbers is essential!
    local xspeed = chasingbullet.GetVar('xspeed') / 2 + xdifference / 100
    local yspeed = chasingbullet.GetVar('yspeed') / 2 + ydifference / 100
    -- Now move the bullet...
    chasingbullet.Move(xspeed, yspeed)
    -- ...and store our new speeds.
    chasingbullet.SetVar('xspeed', xspeed)
    chasingbullet.SetVar('yspeed', yspeed)
end
</pre>
            </div>
            <p>以下は(上記の?)ほぼ全ての関数を使用して作られたウェーブの例です。アリーナより上側
                (assuming a width/height of 155/130)に発射体(Projectile)を生成し、X方向の速度をランダムに設定して、落下させます。
                アリーナの下の境界線に当たると跳ね返り、アリーナの外に向かった弾丸はそのまま落ちます。
            </p>
            <div class="code-container">
<pre class="brush: lua;">spawntimer = 0
bullets = {}

-- This happens every frame while you're defending. --
function Update()
    spawntimer = spawntimer + 1 --Add 1 to the counter every frame

    -- This part takes care of bullet spawning. --
    if spawntimer%30 == 0 then  --This happens every 30 frames.
        local posx = 30 - math.random(60) --Set a random X position between -30 and 30
        local posy = 65 --and set the Y position to 65, on the top edge of the arena.
        local bullet = CreateProjectile('hOI!!!!', posx, posy) -- Create projectile with sprite hOI!!!!.png
        bullet.SetVar('velx', 1 - 2*math.random()) -- We'll use this for horizontal speed. Random between -1/1
        bullet.SetVar('vely', 0) -- We'll use this for fall speed. We're starting without downward movement.
        table.insert(bullets, bullet) -- Add this new Bullet object to the bullets table up there.
    end

    -- This part updates every bullet in the bullets table. --
    for i=1,#bullets do -- #bullets in Lua means 'length of bullets table'.
        local bullet = bullets[i] -- For convenience, so we don't have to use bullets[i]
        local velx = bullet.GetVar('velx') -- Get the X/Y velocity we just set
        local vely = bullet.GetVar('vely')
        local newposx = bullet.x + velx -- New position will be old position + velocity
        local newposy = bullet.y + vely
        if(bullet.x &gt; -Arena.width/2 and bullet.x &lt; Arena.width/2) then -- Are we inside the arena (horizontally)?
            if(bullet.y &lt; -Arena.height/2 + 8) then -- And did we go past the bottom edge?
                bullet.MoveTo(bullet.x, -Arena.height/2 + 8) -- Don't move it past the edge!
                -- Note the +8; I know the bullet sprite I'm using is 16x16.
                -- Without adding 8 it'll be inside the edge.
                vely = 4 --reverse bounce direction
            end
        end
        vely = vely - 0.04 -- Apply gravity
        bullet.MoveTo(newposx, newposy) -- and finally, move our bullet
        bullet.SetVar('vely', vely) -- and store our new fall speed into the bullet again.
    end
end </pre>
            </div>

            <p>
                <br><span class="function">OnHit(<span class="userdata">bullet</span> bullet)</span>
                弾丸とプレイヤーが衝突するたびに、発射体を生成したスクリプトで呼び出されます。
                この関数のパラメータである弾丸は必要に応じて、変更できます。弾丸の制御に関しては上記を
                参照してください。<br>
                <br>
                この関数をスクリプトに実装すると、弾丸に当たった後の挙動を、手動で設定する必要があります。
                これを使用して、シアン(青)色やオレンジ色、緑色の弾丸の挙動を設定できます。
                この関数をウェーブスクリプトに実装しない場合は、常に弾丸は当たるたび３ダメージを与えるようになります。
                以下は、この関数の使用方法の例です。</p>
<div class="code-container"><pre class="brush:lua;">--Defining your own damage for this wave
function OnHit(bullet)
    Player.Hurt(10)
end</pre></div>
<div class="code-container"><pre class="brush:lua;">--Replicating cyan bullet functionality
function OnHit(bullet)
    if Player.isMoving then
        Player.Hurt(5)
    end
end</pre></div>
<div class="code-container"><pre class="brush:lua;">--Replicating orange bullet functionality; opposite condition of cyan
function OnHit(bullet)
    if not Player.isMoving then
        Player.Hurt(5)
    end
end</pre></div>
<div class="code-container"><pre class="brush:lua;">--Replicating green bullet functionality
function OnHit(bullet)
    Player.Heal(1)
    bullet.Remove()
end</pre></div>
        </div>

        <div class="tab-pane text-style" id="mercy">
            <h2 style="text-decoration: none; line-height:50px;">
                * YOU WON!<br>
                * You earned 0 EXP and 0 gold.<br>
                * also the nav menu is broken now
            </h2><br>
        </div>
    </div>
</div>

<div class="container">
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/fightbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/actbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/itembt_0.png" height="42">
    </div>
    <div class="col-xs-3"><a href="#mercy" data-toggle="tab"><img class="centerbt black" alt="Undertale fake button"
                                                                  src="../img/mercybt_0.png" height="42"></a>
    </div>
</div>
<br>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/show_hide_comments.js"></script>

<script type="text/javascript" src="../js/FontToggleButton.js"></script>
</body>
</html>